import{z as R}from"./zh-cn-fdcbec76.js";import{_ as H,u as O,a as P,b as G,j as m,k as J,l as f,r as p,o as b,c as x,f as _,g as C,w as s,h as K,i as N,e,F as Q,x as E,n as u,E as y,y as A,z as W}from"./index-b95edb8d.js";const X={class:"ALL"},Y={class:"All_search"},Z=["src"],ee={key:1,style:{color:"#7f7f7f"}},oe={class:"ALL_page"},te={__name:"index",setup(ae){const o=O(),v=P();G();const h=m(),k=m(""),c=m(),t=m({pageNo:1,pageNumber:3,bookname:""});J(()=>{o.dispatch("book",t),B()});const B=async()=>{let a=await f.get("http://localhost/booksy/booktotal.php");h.value=a.data},V=a=>{t.value.pageNumber=a,t.value.bookname=c,o.dispatch("book",t)},$=a=>{t.value.pageNo=a,t.value.bookname=c,o.dispatch("book",t)},z=async(a,l)=>{let i=await f.post("http://localhost/booksy/findbook.php",E.stringify({bookname:c.value})),g=[];if(k.value=i.data,k.value!=null)for(let d=0;d<i.data.length;d++)g.indexOf(i.data[d].book_name)===-1&&g.push(i.data[d].book_name);let r=g.map(d=>({value:d}));l(r)},I=()=>{t.value.bookname=c,o.dispatch("book",t),k.value==null?h.value=0:h.value=k.value.length},L=()=>{k.value="",c.value="",o.dispatch("book",t),B()},S=a=>{v.push({path:"HotDetail",query:{book_id:o.state.bookInfo[a].book_id}})},D=async a=>{if(o.state.userLocalCache=="")o.state.showlogin=1;else{let l=await f.get("http://localhost/booksy/book_borrow.php",{params:{account:o.state.userLocalCache,bookid:o.state.bookInfo[a].book_id}});l.data=="login"?(y({message:"请先登录",type:"error"}),o.state.showlogin=1):l.data=="yes"?(y({type:"success",message:"借书成功"}),o.dispatch("book",t)):l.data=="max5"?A.error({message:"每个人最多可借5本书,请先归还~",position:"bottom-right"}):l.data==-1&&A.error({message:"图书库存不足",position:"bottom-right"})}},q=()=>{v.push({path:"/index/AddEditBook"})},M=a=>{v.push({path:"/index/AddEditBook",query:{book_id:a}})},T=a=>{W.confirm("你确定要删除吗?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{(await f.post("http://localhost/booksy/deletebook.php",E.stringify({book_id:a}))).data=="yes"?(y({type:"success",message:"删除成功"}),o.dispatch("book",t)):y({type:"error",message:"删除失败"})})};return(a,l)=>{const i=p("el-button"),g=p("el-autocomplete"),r=p("el-table-column"),d=p("el-table"),U=p("el-scrollbar"),j=p("el-pagination"),F=p("el-config-provider");return b(),x(Q,null,[_(o).state.identity!="用户"&&_(o).state.identity!=""?(b(),C(i,{key:0,class:"addbook",type:"primary",onClick:q},{default:s(()=>[u(" 添加图书 ")]),_:1})):K("",!0),N("div",X,[N("div",Y,[e(g,{modelValue:c.value,"onUpdate:modelValue":l[0]||(l[0]=n=>c.value=n),"fetch-suggestions":z,clearable:"",class:"inline-input w-50","trigger-on-focus":!1,placeholder:"请输入书籍名字",onSelect:z},null,8,["modelValue"]),e(i,{onClick:I,disabled:!c.value},{default:s(()=>[u("搜索")]),_:1},8,["disabled"]),e(i,{onClick:L},{default:s(()=>[u("重置")]),_:1})]),e(U,{height:"50vh"},{default:s(()=>[e(d,{data:_(o).state.bookInfo,border:"",style:{width:"100%"},"row-style":{height:"80px"},"empty-text":"暂无图书"},{default:s(()=>[e(r,{prop:"book_type",label:"书籍类型",width:"140",align:"center"}),e(r,{prop:"book_name",label:"书籍名字",width:"200",align:"center"}),e(r,{prop:"book_AuthorName",label:"作者",align:"center"}),e(r,{prop:"book_press",label:"出版社",align:"center"}),e(r,{prop:"book_isbn",label:"ISBN",align:"center",width:"140"}),e(r,{label:"图片",width:"160",prop:"book_photo",align:"center"},{default:s(n=>[n.row.book_photo?(b(),x("img",{key:0,src:n.row.book_photo,alt:"",style:{height:"100px"}},null,8,Z)):(b(),x("span",ee,"暂无图片"))]),_:1}),e(r,{prop:"book_number",width:"60",label:"数量",align:"center"}),e(r,{prop:"book_more",width:"90",label:"借阅人数",align:"center"}),_(o).state.identity!="用户"&&_(o).state.identity!=""?(b(),C(r,{key:0,label:"操作",align:"center",width:"180"},{default:s(n=>[e(i,{color:"rgb(222, 226, 227)",onClick:w=>M(n.row.book_id)},{default:s(()=>[u(" 编辑 ")]),_:2},1032,["onClick"]),e(i,{color:"rgb(143, 171, 180)",onClick:w=>T(n.row.book_id)},{default:s(()=>[u(" 删除 ")]),_:2},1032,["onClick"])]),_:1})):(b(),C(r,{key:1,label:"操作",align:"center",width:"180"},{default:s(n=>[e(i,{color:"rgb(222, 226, 227)",onClick:w=>S(n.$index)},{default:s(()=>[u(" 详细 ")]),_:2},1032,["onClick"]),e(i,{color:"rgb(143, 171, 180)",onClick:w=>D(n.$index)},{default:s(()=>[u(" 借阅")]),_:2},1032,["onClick"])]),_:1}))]),_:1},8,["data"])]),_:1}),N("div",oe,[e(F,{locale:_(R)},{default:s(()=>[e(j,{background:"","current-page":t.value.pageNo,"onUpdate:currentPage":l[1]||(l[1]=n=>t.value.pageNo=n),"page-size":t.value.pageNumber,"onUpdate:pageSize":l[2]||(l[2]=n=>t.value.pageNumber=n),"page-sizes":[3,6,12,18],layout:"total, sizes, prev, pager, next, jumper",total:h.value,onSizeChange:V,onCurrentChange:$},null,8,["current-page","page-size","total"])]),_:1},8,["locale"])])])],64)}}},se=H(te,[["__scopeId","data-v-4ba64d29"]]);export{se as default};
