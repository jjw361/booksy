import{u as T,j as m,B as X,r,o as y,g as M,w as a,i as w,e,n as v,l as E,x as G,E as D,d as Y,k as Z,c as O,h as V,t as P,f as U,M as ee,N as te,F as ae,_ as le}from"./index-b95edb8d.js";import{z as oe}from"./zh-cn-fdcbec76.js";const se={class:"modify"},ne={__name:"idnex",emits:["RefreshDeleteListF"],setup(H,{expose:s,emit:k}){const h=T(),i=m(!1),l=X({user_number:"",user_id:"",admin_account:h.state.userLocalCache,admin_password:""}),t=m();s({showdeletedialog(c){i.value=!0,l.user_number=c.user_number,l.user_id=c.user_id}});const F=async()=>{await t.value.validate();let c=await E.post("http://localhost/booksy/deleteuser.php",G.stringify({deleteinfo:l}));console.log(c.data),c.data=="yes"?(D({type:"success",message:"删除成功"}),i.value=!1,x()):c.data=="borrowno"?D({type:"error",message:"该用户还有书未归还"}):c.data=="pwno"?D({type:"error",message:"管理员密码错误"}):D({type:"error",message:"删除失败"})},x=()=>{k("RefreshDeleteListF")},L=()=>{l.admin_password="",t.value.resetFields()},S={admin_password:[{validator:(c,d,f)=>{d?f():f("请输入密码")},trigger:"change"}]};return(c,d)=>{const f=r("el-input"),b=r("el-form-item"),N=r("el-button"),z=r("el-popconfirm"),A=r("el-form"),$=r("el-dialog");return y(),M($,{onClose:L,modelValue:i.value,"onUpdate:modelValue":d[3]||(d[3]=g=>i.value=g),title:"删除账号",width:"25%",center:""},{default:a(()=>[w("div",se,[e(A,{model:l,ref_key:"deleteform",ref:t,rules:S,"label-width":"100px","before-close":"modifycleanvlaue"},{default:a(()=>[e(b,{label:"删除的账号"},{default:a(()=>[e(f,{disabled:"",modelValue:l.user_number,"onUpdate:modelValue":d[0]||(d[0]=g=>l.user_number=g)},null,8,["modelValue"])]),_:1}),e(b,{label:"管理员账号"},{default:a(()=>[e(f,{disabled:"",modelValue:l.admin_account,"onUpdate:modelValue":d[1]||(d[1]=g=>l.admin_account=g)},null,8,["modelValue"])]),_:1}),e(b,{label:"管理员密码",prop:"admin_password"},{default:a(()=>[e(f,{modelValue:l.admin_password,"onUpdate:modelValue":d[2]||(d[2]=g=>l.admin_password=g)},null,8,["modelValue"])]),_:1}),e(b,null,{default:a(()=>[e(z,{title:"你确定要删除吗","confirm-button-text":"确定","cancel-button-text":"取消",onConfirm:F},{reference:a(()=>[e(N,{type:"primary",style:{width:"150px"}},{default:a(()=>[v("删除")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"])}}},re={class:"Managing_top"},ie={class:"Managing_top_left"},de={class:"Managing_top_right"},ue={class:"Managing"},ce={class:"Managing_search"},_e={style:{color:"red"}},pe={key:2,class:"Managing_page"},me=Y({__name:"index",setup(H){const s=T(),k=m(),h=m(""),i=m(),l=m(!0),t=m({pageNo:1,pageNumber:6,user_number:"",user_identity:"用户"});Z(()=>{s.dispatch("Users",t),x()});const F=()=>{i.value="",t.value.user_number="",l.value==!0?(t.value.user_identity="用户",s.dispatch("Users",t),x()):(t.value.user_identity="管理员",s.dispatch("Users",t),x())},x=async()=>{let u=await E.get("http://localhost/booksy/Managingtotal.php",{params:{identity:t.value.user_identity}});k.value=u.data},L=u=>{t.value.user_number=i.value,t.value.pageNumber=u,s.dispatch("Users",t)},j=u=>{t.value.user_number=i.value,t.value.pageNo=u,s.dispatch("Users",t)},S=async(u,p)=>{let C=await E.post("http://localhost/booksy/finduserManagingaccount.php",G.stringify({identity:t.value.user_identity,Managingaccount:u})),_=[];if(h.value=C.data,h.value!=null)for(let n=0;n<C.data.length;n++)_.indexOf(C.data[n].user_number)===-1&&_.push(C.data[n].user_number);let R=_.map(n=>({value:n}));p(R)},c=()=>{t.value.user_number=i.value,h.value==null?k.value=0:k.value=h.value.length,s.dispatch("Users",t)},d=()=>{t.value.user_number="",h.value="",i.value="",s.dispatch("Users",t),x()},f=m(),b=u=>{f.value.showdeletedialog(u)},N=m(),z=u=>{N.value.adminmodify(u)},A=m(),$=()=>{A.value.showaddadmin()},g=()=>{s.dispatch("Users",t)},J=()=>{s.dispatch("Users",t)},K=()=>{console.log(1),s.dispatch("Users",t)};return(u,p)=>{const C=r("el-switch"),_=r("el-button"),R=r("el-autocomplete"),n=r("el-table-column"),I=r("el-table"),q=r("el-scrollbar"),Q=r("el-pagination"),W=r("el-config-provider");return y(),O(ae,null,[w("div",re,[w("div",ie,[e(C,{size:"large",modelValue:l.value,"onUpdate:modelValue":p[0]||(p[0]=o=>l.value=o),style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:F,"active-text":"用户","inactive-text":"管理员"},null,8,["modelValue"])]),w("div",de,[l.value==!1?(y(),M(_,{key:0,class:"addbook",type:"primary",onClick:$},{default:a(()=>[v(" 添加管理员 ")]),_:1})):V("",!0)])]),w("div",ue,[w("div",ce,[e(R,{modelValue:i.value,"onUpdate:modelValue":p[1]||(p[1]=o=>i.value=o),"fetch-suggestions":S,clearable:"",class:"inline-input w-50","trigger-on-focus":!1,placeholder:"请输入账号"},null,8,["modelValue"]),e(_,{onClick:c,disabled:!i.value},{default:a(()=>[v("搜索")]),_:1},8,["disabled"]),e(_,{onClick:d},{default:a(()=>[v("重置")]),_:1})]),l.value?(y(),M(q,{key:0,height:"50vh"},{default:a(()=>[e(I,{data:U(s).state.Users,border:"",style:{width:"100%"},"row-style":{height:"60px"},"empty-text":"暂无用户"},{default:a(()=>[e(n,{prop:"user_identity",label:"身份",align:"center"}),e(n,{prop:"user_name",label:"用户名",align:"center"}),e(n,{prop:"user_number",label:"用户账号",align:"center"}),e(n,{label:"借书量",align:"center"},{default:a(o=>[v(P(5-o.row.max_number),1)]),_:1}),e(n,{label:"操作",align:"center"},{default:a(o=>[e(_,{onClick:B=>z(o.row),color:"#aec4b7"},{default:a(()=>[v("修改")]),_:2},1032,["onClick"]),e(_,{onClick:B=>b(o.row),color:"#aec4b7"},{default:a(()=>[v("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})):V("",!0),l.value?V("",!0):(y(),M(q,{key:1,height:"50vh"},{default:a(()=>[e(I,{data:U(s).state.Users,border:"",style:{width:"100%"},"row-style":{height:"60px"},"empty-text":"暂无管理员"},{default:a(()=>[e(n,{label:"身份",align:"center"},{default:a(o=>[w("span",_e,P(o.row.user_identity),1)]),_:1}),e(n,{prop:"user_name",label:"管理员名",align:"center"}),e(n,{prop:"user_number",label:"管理员账号",align:"center"}),U(s).state.identity=="超级管理员"?(y(),M(n,{key:0,label:"操作",align:"center"},{default:a(o=>[e(_,{color:"#aec4b7",onClick:B=>z(o.row)},{default:a(()=>[v("修改")]),_:2},1032,["onClick"]),e(_,{onClick:B=>b(o.row),color:"#aec4b7"},{default:a(()=>[v("删除")]),_:2},1032,["onClick"])]),_:1})):V("",!0)]),_:1},8,["data"])]),_:1})),U(s).state.Users?(y(),O("div",pe,[e(W,{locale:U(oe)},{default:a(()=>[e(Q,{background:"","current-page":t.value.pageNo,"onUpdate:currentPage":p[2]||(p[2]=o=>t.value.pageNo=o),"page-size":t.value.pageNumber,"onUpdate:pageSize":p[3]||(p[3]=o=>t.value.pageNumber=o),"page-sizes":[6,12],layout:"total, sizes, prev, pager, next, jumper",total:k.value,onSizeChange:L,onCurrentChange:j},null,8,["current-page","page-size","total"])]),_:1},8,["locale"])])):V("",!0),e(ne,{ref_key:"Deletechlid",ref:f,onRefreshDeleteListF:g},null,512),e(ee,{ref_key:"Modifychild",ref:N,onRefreshModifyListF:J},null,512),e(te,{ref_key:"AddAdminchild",ref:A,onRefreshadminListF:K},null,512)])],64)}}});const ve=le(me,[["__scopeId","data-v-cf6cc2fb"]]);export{ve as default};
