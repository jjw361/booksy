import{d as T,a as z,b as G,j as b,B as J,k as L,l as c,x as f,r as d,o as h,g as V,w as a,i as A,e as t,f as B,C as O,n as w,E as _,D as Q,_ as W}from"./index-b95edb8d.js";import{E as X}from"./wangEditor-aa7c5af9.js";const Y={class:"AddBook"},Z=["src"],ee=T({__name:"index",setup(oe){let x=z(),p=G();const N=b(""),g=b(!1),e=J({book_name:"",book_AuthorName:"",book_number:"",book_photo:"",book_type:"",book_press:"",book_isbn:"",book_content:""}),k=b(),u=b();L(()=>{q()});const q=async()=>{if(p.query.book_id!=null){let s=await c.post("http://localhost/booksy/getbookdetail.php",f.stringify({bookid:p.query.book_id}));s.status==200&&(u.value=s.data,e.book_name=u.value[0].book_name,e.book_AuthorName=u.value[0].book_AuthorName,e.book_number=u.value[0].book_number,e.book_photo=u.value[0].book_photo,e.book_type=u.value[0].book_type,e.book_press=u.value[0].book_press,e.book_isbn=u.value[0].book_isbn,e.book_content=u.value[0].book_content,y.value.setHtml(e.book_content))}},F=async(s,o)=>{await c.post("http://localhost/booksy/deletephoto.php",f.stringify({photoname:s.response.data.name}))},C=(s,o,l)=>{e.book_photo=s.data.url,_({message:"上传成功",type:"success"})},E=s=>{N.value=s.url,g.value=!0},m=b(),I=s=>{m.value.clearFiles();const o=s[0];o.uid=Q(),m.value.handleStart(o)},y=b(null),U=()=>{e.book_content=y.value.getHtml()},$=async()=>{await k.value.validate();try{e.book_content==""?_({type:"error",message:"书籍介绍不能为空"}):(await c.post("http://localhost/booksy/addbook.php",f.stringify({bookinfo:e}))).data=="yes"?(_({type:"success",message:"添加成功"}),x.go(-1)):_({type:"error",message:"添加失败"})}catch{}},S=async()=>{await k.value.validate(),e.book_content==""?_({type:"error",message:"请输入书籍介绍"}):(await c.post("http://localhost/booksy/editbook.php",f.stringify({bookinfo:e,book_id:p.query.book_id}))).data=="yes"?(_({type:"success",message:"修改成功"}),x.go(-1)):_({type:"error",message:"修改失败"})},P=()=>{m.value.clearFiles(),k.value.resetFields(),e.book_name="",e.book_AuthorName="",e.book_number="",e.book_photo="",e.book_type="",e.book_press="",e.book_isbn="",e.book_content=""},R={book_name:[{validator:(s,o,l)=>{o?l():l("请输入书籍名字")},trigger:"change",required:!0}],book_AuthorName:[{validator:(s,o,l)=>{o?l():l("请输入作者名字")},trigger:"change",required:!0}],book_number:[{validator:(s,o,l)=>{/^[1-9]\d*$/.test(o)?l():l("请输入大于0的数字")},trigger:"change",required:!0}],book_type:[{validator:(s,o,l)=>{o?/^[\u4E00-\u9FA5]{1,50}$/.test(o)?l():l("请输入中文"):l("请输入书籍类型")},trigger:"change",required:!0}],book_press:[{validator:(s,o,l)=>{o?/^[\u4E00-\u9FA5]{1,50}$/.test(o)?l():l("请输入正确的出版社"):l("请输入出版社")},trigger:"change",required:!0}],book_isbn:[{validator:(s,o,l)=>{o?/^978[\d]{10}|ISBN[\d]{13}$/.test(o)?l():l("请输入正确的ISBN"):l("请输入ISBN")},trigger:"change",required:!0}]};return(s,o)=>{const l=d("el-input"),n=d("el-form-item"),i=d("el-col"),H=d("el-icon"),M=d("el-upload"),j=d("el-dialog"),v=d("el-button"),D=d("el-form"),K=d("el-scrollbar");return h(),V(K,{height:"80vh"},{default:a(()=>[A("div",Y,[t(D,{ref_key:"addeditbookform",ref:k,model:e,"label-width":"100px",class:"demo-form-inline","label-position":"right",rules:R},{default:a(()=>[t(i,{span:6},{default:a(()=>[t(n,{label:"书籍名字:",prop:"book_name"},{default:a(()=>[t(l,{modelValue:e.book_name,"onUpdate:modelValue":o[0]||(o[0]=r=>e.book_name=r),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(i,{span:6},{default:a(()=>[t(n,{label:"书籍类型:",prop:"book_type"},{default:a(()=>[t(l,{modelValue:e.book_type,"onUpdate:modelValue":o[1]||(o[1]=r=>e.book_type=r),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(i,{span:6},{default:a(()=>[t(n,{label:"作者名字:",prop:"book_AuthorName"},{default:a(()=>[t(l,{modelValue:e.book_AuthorName,"onUpdate:modelValue":o[2]||(o[2]=r=>e.book_AuthorName=r),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(i,{span:6},{default:a(()=>[t(n,{label:"数量:",prop:"book_number"},{default:a(()=>[t(l,{modelValue:e.book_number,"onUpdate:modelValue":o[3]||(o[3]=r=>e.book_number=r),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(i,{span:6},{default:a(()=>[t(n,{label:"出版社:",prop:"book_press"},{default:a(()=>[t(l,{modelValue:e.book_press,"onUpdate:modelValue":o[4]||(o[4]=r=>e.book_press=r),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(i,{span:6},{default:a(()=>[t(n,{label:"ISBN:",prop:"book_isbn"},{default:a(()=>[t(l,{modelValue:e.book_isbn,"onUpdate:modelValue":o[5]||(o[5]=r=>e.book_isbn=r),clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(i,{span:20},{default:a(()=>[t(n,{label:"书籍图片:"},{default:a(()=>[t(M,{ref_key:"upload",ref:m,limit:1,"on-success":C,"on-exceed":I,action:"http://localhost/booksy/photo.php","list-type":"picture-card","on-preview":E,"on-remove":F},{default:a(()=>[t(H,null,{default:a(()=>[t(B(O))]),_:1})]),_:1},512),t(j,{modelValue:g.value,"onUpdate:modelValue":o[6]||(o[6]=r=>g.value=r)},{default:a(()=>[A("img",{"w-full":"",style:{width:"100%",height:"100%"},src:N.value,alt:"Preview Image"},null,8,Z)]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(i,{span:24},{default:a(()=>[t(n,{label:"书籍介绍:"},{default:a(()=>[t(X,{onKeyup:U,ref_key:"children",ref:y},null,512)]),_:1})]),_:1}),t(n,null,{default:a(()=>[B(p).query.book_id==null?(h(),V(v,{key:0,type:"success",style:{width:"100px"},onClick:$},{default:a(()=>[w("添加")]),_:1})):(h(),V(v,{key:1,type:"success",style:{width:"100px"},onClick:S},{default:a(()=>[w("修改")]),_:1})),t(v,{type:"warning",style:{width:"100px"},onClick:P},{default:a(()=>[w("重置")]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1})}}});const ie=W(ee,[["__scopeId","data-v-9561a29d"]]);export{ie as default};
