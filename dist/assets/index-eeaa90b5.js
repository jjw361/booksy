import{z as U}from"./zh-cn-fdcbec76.js";import{d as j,u as L,j as g,k as M,l as m,r as b,o as v,c as f,i as q,e,w as p,n as w,f as h,h as A,x as D,E as y,_ as O}from"./index-b95edb8d.js";const P={class:"Borrow"},T={class:"Borrow_search"},$={key:0,class:"Borrow_page"},F=j({__name:"index",setup(G){const t=L(),_=g(),d=g(""),s=g(),o=g({pageNo:1,pageNumber:6,user_number:""});M(()=>{t.dispatch("borrowbook",o),k()});const k=async()=>{let a=await m.get("http://localhost/booksy/bookborrowtotal.php",{params:{account:t.state.userLocalCache}});_.value=a.data},C=a=>{o.value.user_number=s,o.value.pageNumber=a,t.dispatch("borrowbook",o)},x=a=>{o.value.user_number=s.value,o.value.pageNo=a,t.dispatch("borrowbook",o)},N=async(a,l)=>{let i=await m.post("http://localhost/booksy/finduserborrowaccount.php",D.stringify({borrowaccount:a})),u=[];if(d.value=i.data,d.value!=null)for(let n=0;n<i.data.length;n++)u.indexOf(i.data[n].bookborrow_number)===-1&&u.push(i.data[n].bookborrow_number);let r=u.map(n=>({value:n}));l(r)},z=()=>{o.value.user_number=s,d.value==null?_.value=0:_.value=d.value.length,t.dispatch("borrowbook",o)},B=()=>{d.value="",s.value="",t.dispatch("borrowbook",o),k()},V=async a=>{(await m.get("http://localhost/booksy/book_return.php",{params:{account:t.state.userLocalCache,user_number:a.bookborrow_number,returnbookid:a.bookborrow_id}})).data=="yes"?(y({type:"success",message:"还书成功"}),t.dispatch("borrowbook",o)):y({type:"error",message:"还书失败"})};return(a,l)=>{const i=b("el-autocomplete"),u=b("el-button"),r=b("el-table-column"),n=b("el-table"),I=b("el-scrollbar"),S=b("el-pagination"),E=b("el-config-provider");return v(),f("div",P,[q("div",T,[e(i,{modelValue:s.value,"onUpdate:modelValue":l[0]||(l[0]=c=>s.value=c),"fetch-suggestions":N,clearable:"",class:"inline-input w-50","trigger-on-focus":!1,placeholder:"请输入账号"},null,8,["modelValue"]),e(u,{onClick:z,disabled:!s.value},{default:p(()=>[w("搜索")]),_:1},8,["disabled"]),e(u,{onClick:B},{default:p(()=>[w("重置")]),_:1})]),e(I,{height:"50vh"},{default:p(()=>[e(n,{data:h(t).state.borrowbookInfo,border:"",style:{width:"100%"},"row-style":{height:"60px"},"empty-text":"暂无借书记录"},{default:p(()=>[e(r,{prop:"bookborrow_number",label:"账号",width:"140",align:"center"}),e(r,{prop:"bookborrow_type",label:"书籍类型",align:"center",width:"120"}),e(r,{prop:"bookborrow_AuthorName",label:"作者",width:"160",align:"center"}),e(r,{prop:"bookborrow_press",label:"出版社",align:"center",width:"140"}),e(r,{prop:"bookborrow_name",label:"书籍名字",align:"center"}),e(r,{prop:"bookborrow_isbn",width:"140",label:"ISBN",align:"center"}),e(r,{prop:"bookborrow_time",sortable:"",width:"180",label:"借书时间",align:"center"}),e(r,{label:"操作",align:"center",width:"90"},{default:p(c=>[e(u,{color:"#aec4b7",onClick:H=>V(c.row)},{default:p(()=>[w("还书")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),h(t).state.borrowbookInfo?(v(),f("div",$,[e(E,{locale:h(U)},{default:p(()=>[e(S,{background:"","current-page":o.value.pageNo,"onUpdate:currentPage":l[1]||(l[1]=c=>o.value.pageNo=c),"page-size":o.value.pageNumber,"onUpdate:pageSize":l[2]||(l[2]=c=>o.value.pageNumber=c),"page-sizes":[6,12],layout:"total, sizes, prev, pager, next, jumper",total:_.value,onSizeChange:C,onCurrentChange:x},null,8,["current-page","page-size","total"])]),_:1},8,["locale"])])):A("",!0)])}}});const Q=O(F,[["__scopeId","data-v-bd7e9dd7"]]);export{Q as default};
